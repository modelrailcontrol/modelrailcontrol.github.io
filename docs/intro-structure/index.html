<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.58">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="MRC Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="MRC Blog Atom Feed"><title data-react-helmet="true">Meddelandestruktur | MRC</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Meddelandestruktur | MRC"><meta data-react-helmet="true" name="description" content="Principen för MQTT är att man skickar ett meddelande (payload) till ett specifikt ämne (topic). Andra kan sedan välja att lyssa på eller prenumerera (subscribe) på ett ämne. När någon sen skickar (publish) ett meddelande till ett ämne, kommer detta meddelande att vidarebefordras till alla som valt att prenumerera/lyssna på detta ämne."><meta data-react-helmet="true" property="og:description" content="Principen för MQTT är att man skickar ett meddelande (payload) till ett specifikt ämne (topic). Andra kan sedan välja att lyssa på eller prenumerera (subscribe) på ett ämne. När någon sen skickar (publish) ett meddelande till ett ämne, kommer detta meddelande att vidarebefordras till alla som valt att prenumerera/lyssna på detta ämne."><meta data-react-helmet="true" property="og:url" content="https://modelrailcontrol.org/docs/intro-structure"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://modelrailcontrol.org/docs/intro-structure"><link rel="stylesheet" href="/styles.8f97edd3.css">
<link rel="preload" href="/styles.21e07410.js" as="script">
<link rel="preload" href="/runtime~main.8f8bd0f9.js" as="script">
<link rel="preload" href="/main.8e102c45.js" as="script">
<link rel="preload" href="/1.f7f5a080.js" as="script">
<link rel="preload" href="/2.3f26408b.js" as="script">
<link rel="preload" href="/56.b9928493.js" as="script">
<link rel="preload" href="/57.bd8eba64.js" as="script">
<link rel="preload" href="/20ac7829.8f1b13fc.js" as="script">
<link rel="preload" href="/17896441.1aa60a8a.js" as="script">
<link rel="preload" href="/66630bbb.66f516a0.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/mrc-logo.svg" alt="MRC-logo"></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Dokumentation</a><a class="navbar__item navbar__link" href="/docs/clients/intro-01-overview">Enheter</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/modelrailcontrol" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/mrc-logo.svg" alt="MRC-logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Dokumentation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/clients/intro-01-overview">Enheter</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/modelrailcontrol" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Meddelandestruktur</h1></header><div class="markdown"><p>Principen för MQTT är att man skickar ett meddelande (payload) till ett specifikt ämne (topic). Andra kan sedan välja att lyssa på eller prenumerera (subscribe) på ett ämne. När någon sen skickar (publish) ett meddelande till ett ämne, kommer detta meddelande att vidarebefordras till alla som valt att prenumerera/lyssna på detta ämne.</p><p>I centrum för detta förfarande finns en meddelandeserver (broker). Det är en central programvara vars enda uppgift lite förenklat är att hantera ämnen, meddelanden och prenumerationer. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="ordlista"></a>Ordlista<a aria-hidden="true" tabindex="-1" class="hash-link" href="#ordlista" title="Direct link to heading">#</a></h3><table><thead><tr><th>Svenska</th><th>Engelska</th><th>Förklaring</th></tr></thead><tbody><tr><td>ämne</td><td>topic</td><td></td></tr><tr><td>meddelande</td><td>payload</td><td></td></tr><tr><td>enhet</td><td>device</td><td></td></tr><tr><td>funktion</td><td>node</td><td></td></tr><tr><td>egenskap</td><td>property</td><td></td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="uppbyggnad"></a>Uppbyggnad<a aria-hidden="true" tabindex="-1" class="hash-link" href="#uppbyggnad" title="Direct link to heading">#</a></h3><p>Ett ämne är alltid uppbyggt på följande sätt:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">mmrc/device/node/property</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="attribut"></a>Attribut<a aria-hidden="true" tabindex="-1" class="hash-link" href="#attribut" title="Direct link to heading">#</a></h3><p>På varje nivå i strukturen kan man sedan sätta attribut, vilka kan varierar beroende på nivån. Dessa attribut används till att ge information om just den nivå där attributet finns, exempelvis:</p><p><code>mmrc/device/$name</code>
där man då har möjlighet att ge enheten ett läsbart namn, kanske &quot;Växel 22&quot;.</p><p><code>mmrc/device/node/$name</code>
där man ger en av enhetens funktioner ett läsbart namn, kanske &quot;Växelstyrning&quot;.</p><p><code>mmrc/device/node/property/$name</code>
där man ger funktionens egenskap ett namn, kanske &quot;Riktning&quot;.</p><p>Vilka attribut som finns och måste användas, finns beskrivet i <a href="/docs/conv-restriction">Konventionen</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="base-topic"></a>Base topic<a aria-hidden="true" tabindex="-1" class="hash-link" href="#base-topic" title="Direct link to heading">#</a></h3><p>Den första nivån i MMRC-strukturen och som grund för alla ämnen i MMRC används följande:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">mmrc/</span></div></div></div></div></div><p>Denna start på ämnet visar att du följer MMRC-konventionen och då ska alltså alla ämnen börja med denna text, exempelvis</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">mmrc/pkin-to001/turnout/turn</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mmrc/1270262539-af/pushbutton/push</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mmrc/bwah-0012/signal/image`</span></div></div></div></div></div><p>Gör du din egen variant av MMRC eller MQTT ämnesstruktur, så måste du hitta på ett eget Base topic.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="device"></a>Device<a aria-hidden="true" tabindex="-1" class="hash-link" href="#device" title="Direct link to heading">#</a></h3><p>Den andra nivån i MMRC-strukturen är identiteten på och informationen om själva enheten:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">mmrc/pkin-sj06/</span></div></div></div></div></div><p>Här är alltså <code>pkin-sj06</code> enhetens identitet i MMRC. Den identiteten måste vara unik och lämpligen skapar man den utifrån sitt namn, järnvägens eller modulens namn och ett löpnummer eller liknande. Exempel på detta kan vara <code>twah-sj06</code>, <code>mne-1955</code> eller <code>ssva-hfs</code>.</p><p>De attribut som finns till den hör nivån är tre stycken och de bildar då tre ämnen som man både kan skicka meddelanden (publish) till och hämta information (subscribe) från:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">mmrc/pkin-sj06/$name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mmrc/pkin-sj06/$state</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mmrc/pkin-sj06/$nodes</span></div></div></div></div></div><ul><li><strong>$name</strong> är det mer läsvänliga namnet på enheten. <em>Exempelvis &quot;Suckunge modul 6&quot; eller &quot;Holmfors station&quot;</em></li><li><strong>$state</strong> talar om i vilken status enheten befinner sig i. Detta är en speciell inställning som även kan visa när en enhet plötslig slutat fungera. Här finns det definierade status i <a href="/docs/conv-restriction">Konventionen</a> som ska användas.</li><li><strong>$nodes</strong> är en kommaseparerad lista över vilka olika funktioner (noder) det finns i enheten. Olika funktioner kan göra olika saker, kanske både hantera en knapp, en lysdiod och en växel.  <em>Exempelvis &quot;turnout1,turnout2&quot; eller &quot;button,led,turnout&quot;.</em></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="några-exempel"></a>Några exempel<a aria-hidden="true" tabindex="-1" class="hash-link" href="#några-exempel" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">mmrc/pkin-1234/$name -&gt; &quot;Växel 22&quot;</span></div></div></div></div></div><p>Här har alltså ämnet <code>mmrc/pkin-1234/$name</code> fått innehållet <code>Växel 22</code>. Exempelvis kan andra enheter alltså få reda på vad denna enhet har för namn genom att hämta information (subscribe) från ämnet <code>mmrc/pkin-1234/$name</code>.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">mmrc/pkin-1234/$state -&gt; &quot;init&quot;</span></div></div></div></div></div><p>Enhetens status har här satts till <code>init</code> vilket enligt konventionen betyder att den är på väg att starta men inte är rikigt färdig. Programvaran i enheten ska sen sätta meddelandet <code>ready</code> när den är klar att börja användas.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">mmrc/pkin-1234/$nodes -&gt; &quot;turnout,button&quot;</span></div></div></div></div></div><p>Det här ämnet talar om vilka funktioner en enhet har. Eftersom konventionen inte definierar vilka funktioner som kan finnas är deras namn/ämne valfritt. Men istället måste man då ange deras namn här.</p><p>De funktioner som anges här, blir alltså ämnet för nästa nivå i strukturen. Så för enheten i detta exempel finns det två ämnen på nivå 3 i strukturen, nämligen <code>mmrc/pkin-1234/turnout</code>och <code>mmrc/pkin-1234/button</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="node"></a>Node<a aria-hidden="true" tabindex="-1" class="hash-link" href="#node" title="Direct link to heading">#</a></h3><p>På den tredje nivån hamnar all information om klientens olika noder, eller kanske man kan kalla dem funktioner. Följande inställningar behöver göras per node:</p><ul><li><strong>nodeID</strong> är den unika identiteten för denna node. Det kan exempelvis vara &quot;turnout&quot;, &quot;signal&quot; eller &quot;button&quot; och om det finns flera noder av samma sort, kanske &quot;signal1&quot; och &quot;signal2&quot;.</li><li><strong>$name</strong> är det mer läsvänliga namnet på noden. <em>Exempelvis &quot;Växel 01&quot; eller &quot;Infartssignal vänster&quot;</em></li><li><strong>$type</strong> beskriver vilken typ av nod det är - vad den gör/hanterar. Här är det ganska fritt vad som anges, men lämpligt kan vara att ange något i stil med &quot;huvudsignal&quot; eller &quot;2-vägs-växel&quot;.</li><li><strong>$properties</strong> är en kommaseparerad lista över vilka olika egenskaper denna node har. Informationen i denna lista kommer från nodens respektive egenskaper.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="föreslagna-funktioner"></a>Föreslagna funktioner<a aria-hidden="true" tabindex="-1" class="hash-link" href="#föreslagna-funktioner" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">mmrc/pkin-1234/turnout</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mmrc/pkin-1234/button</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mmrc/pkin-1234/switch</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mmrc/pkin-1234/signal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mmrc/pkin-1234/barrier</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mmrc/pkin-1234/decoupler</span></div></div></div></div></div><p>Har man flera liknande funktioner, exempelvis två knappar som styr två växlar, kan man använda följande namn/funktioner:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">mmrc/pkin-1234/turnout1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mmrc/pkin-1234/turnout2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mmrc/pkin-1234/button1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mmrc/pkin-1234/button2</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="property"></a>Property<a aria-hidden="true" tabindex="-1" class="hash-link" href="#property" title="Direct link to heading">#</a></h3><p>På sista nivån talar man om vilka egenskaper varje nod har.</p><ul><li><strong>property</strong> är en (av kanske flera) egenskaper som denna denna node har. För en signal skulle det kunna vara &quot;main&quot; och &quot;slave&quot; för huvudsignal och försignal eller för enklare saker kanske bara &quot;move&quot;, &quot;light&quot; eller &quot;push&quot;.</li><li><strong>$name</strong> är det mer läsvänliga namnet på egenskapen. <em>Exempelvis &quot;Växelomläggning&quot; eller &quot;Signalbild&quot;</em></li><li><strong>$datatype</strong> beskriver vilken typ av data som kan läsas från och/eller skickas till egenskapen. Vilka egenskaper som kan förekomma finns att läsa i MMRC Convention. <em>Exempelvis &quot;string&quot; eller &quot;boolean&quot;.</em></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/modelrailcontrol/MRC-documentation/tree/master/docs/intro-structure.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ordlista" class="table-of-contents__link">Ordlista</a></li><li><a href="#uppbyggnad" class="table-of-contents__link">Uppbyggnad</a></li><li><a href="#attribut" class="table-of-contents__link">Attribut</a></li><li><a href="#base-topic" class="table-of-contents__link">Base topic</a></li><li><a href="#device" class="table-of-contents__link">Device</a></li><li><a href="#några-exempel" class="table-of-contents__link">Några exempel</a></li><li><a href="#node" class="table-of-contents__link">Node</a></li><li><a href="#föreslagna-funktioner" class="table-of-contents__link">Föreslagna funktioner</a></li><li><a href="#property" class="table-of-contents__link">Property</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Dokumentation</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Översikt</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/struct-intro/">Struktur</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Gemenskap</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.svensktmjforum.se/forum/index.php?topic=21831.0" target="_blank" rel="noopener noreferrer" class="footer__link-item">Svenskt MJ-forum</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Övrigt</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/modelrailcontrol" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://v2.docusaurus.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus</a></li></ul></div></div><div class="text--center"><div>CC-BY-SA © 2020 Model Rail Control</div></div></div></footer></div>
<script src="/styles.21e07410.js"></script>
<script src="/runtime~main.8f8bd0f9.js"></script>
<script src="/main.8e102c45.js"></script>
<script src="/1.f7f5a080.js"></script>
<script src="/2.3f26408b.js"></script>
<script src="/56.b9928493.js"></script>
<script src="/57.bd8eba64.js"></script>
<script src="/20ac7829.8f1b13fc.js"></script>
<script src="/17896441.1aa60a8a.js"></script>
<script src="/66630bbb.66f516a0.js"></script>
</body>
</html>