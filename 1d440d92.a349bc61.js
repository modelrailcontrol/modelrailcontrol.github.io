(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{135:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=r.a.createContext({}),c=function(e){var t=r.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):b(b({},t),e)),n},d=function(e){var t=c(e.components);return r.a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),d=c(n),u=a,m=d["".concat(l,".").concat(u)]||d[u]||p[u]||i;return n?r.a.createElement(m,b(b({ref:t},s),{},{components:n})):r.a.createElement(m,b({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,l=new Array(i);l[0]=u;var b={};for(var o in t)hasOwnProperty.call(t,o)&&(b[o]=t[o]);b.originalType=e,b.mdxType="string"==typeof e?e:a,l[1]=b;for(var s=2;s<i;s++)l[s]=n[s];return r.a.createElement.apply(null,l)}return r.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},198:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/software-servo-back-38f68bed48ac1e3f50964d9dc1678a57.svg"},75:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return l})),n.d(t,"metadata",(function(){return b})),n.d(t,"rightToc",(function(){return o})),n.d(t,"default",(function(){return c}));var a=n(3),r=n(7),i=(n(0),n(135)),l={title:"Programvaran"},b={unversionedId:"clients/trn-software",id:"clients/trn-software",isDocsHomePage:!1,title:"Programvaran",description:"En f\xf6ruts\xe4ttning f\xf6r att kunna  ladda programvaran till enheten \xe4r att du har installerat Arduinos utvecklingsmilj\xf6 (IDE) p\xe5 din dator. Hur du g\xf6r dessa f\xf6rberedelser beskrivs mer p\xe5 sidan B\xf6rja programmera.",source:"@site/docs/clients/trn-software.md",slug:"/clients/trn-software",permalink:"/docs/clients/trn-software",editUrl:"https://github.com/modelrailcontrol/MRC-documentation/blob/master/docs/clients/trn-software.md",version:"current",sidebar:"Enheter",previous:{title:"Montering",permalink:"/docs/clients/trn-assemble"},next:{title:"Inst\xe4llningar",permalink:"/docs/clients/trn-settings"}},o=[{value:"Grundinst\xe4llningar",id:"grundinst\xe4llningar",children:[{value:"In- och utg\xe5ngar",id:"in--och-utg\xe5ngar",children:[]},{value:"Namn och l\xf6senord",id:"namn-och-l\xf6senord",children:[]},{value:"Fels\xf6kning",id:"fels\xf6kning",children:[]}]},{value:"Huvudprogrammet",id:"huvudprogrammet",children:[{value:"Program-initiering",id:"program-initiering",children:[]},{value:"Huvudprogrammet",id:"huvudprogrammet-1",children:[]},{value:"Knapp-hantering",id:"knapp-hantering",children:[]},{value:"Servohantering",id:"servohantering",children:[]}]},{value:"Servo-funktioner",id:"servo-funktioner",children:[{value:"Skapa ett servo-objekt",id:"skapa-ett-servo-objekt",children:[]},{value:"St\xe4ll in servots egenskaper",id:"st\xe4ll-in-servots-egenskaper",children:[]},{value:"Servo-hantering",id:"servo-hantering",children:[]},{value:"Flytta servot",id:"flytta-servot",children:[]},{value:"Detektera servots \xe4ndpunkter",id:"detektera-servots-\xe4ndpunkter",children:[]},{value:"H\xe4mta servostatus",id:"h\xe4mta-servostatus",children:[]},{value:"H\xe4mta servoposition",id:"h\xe4mta-servoposition",children:[]}]},{value:"Status-funktioner",id:"status-funktioner",children:[{value:"Skapa ett status-objekt",id:"skapa-ett-status-objekt",children:[]},{value:"Status-hantering",id:"status-hantering",children:[]},{value:"Statushantering",id:"statushantering",children:[]},{value:"H\xe4mta status",id:"h\xe4mta-status",children:[]}]},{value:"MQTT-funktioner",id:"mqtt-funktioner",children:[{value:"PubSubClient",id:"pubsubclient",children:[]},{value:"Inst\xe4llningar f\xf6r MQTT",id:"inst\xe4llningar-f\xf6r-mqtt",children:[]},{value:"Anslut till MQTT-server",id:"anslut-till-mqtt-server",children:[]},{value:"Publicera meddelande",id:"publicera-meddelande",children:[]},{value:"Prenumerera p\xe5 meddelanden",id:"prenumerera-p\xe5-meddelanden",children:[]}]},{value:"Wifi-funktioner",id:"wifi-funktioner",children:[{value:"IotWebConf",id:"iotwebconf",children:[]},{value:"Spara inst\xe4llningar",id:"spara-inst\xe4llningar",children:[]},{value:"Inst\xe4llningar f\xf6r wifi",id:"inst\xe4llningar-f\xf6r-wifi",children:[]}]}],s={rightToc:o};function c(e){var t=e.components,l=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},s,l,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"En f\xf6ruts\xe4ttning f\xf6r att kunna  ladda programvaran till enheten \xe4r att du har installerat Arduinos utvecklingsmilj\xf6 (IDE) p\xe5 din dator. Hur du g\xf6r dessa f\xf6rberedelser beskrivs mer p\xe5 sidan ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"intro-arduino"}),"B\xf6rja programmera"),". "),Object(i.b)("p",null,"Det \xe4r en eng\xe5ngsuppgift, s\xe5 har du en g\xe5ng gjort iordning en MRC-enhet ska du inte beh\xf6va g\xf6ra om f\xf6rberedelserna igen."),Object(i.b)("p",null,"Programvaran \xe4r uppdelad i flera olika filer, f\xf6r att ge b\xe4ttre \xf6verblick. F\xf6ljande delar finns:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"mrc-2turnout - ",Object(i.b)("em",{parentName:"li"},"Sj\xe4lva huvudprogrammet")),Object(i.b)("li",{parentName:"ul"},"mrcMqtt - ",Object(i.b)("em",{parentName:"li"},"Hantering & inst\xe4llningar av MQTT-kommunikationen")),Object(i.b)("li",{parentName:"ul"},"mrcServo - Hantering & inst\xe4llningar av servon**"),Object(i.b)("li",{parentName:"ul"},"mrcSettings - ",Object(i.b)("em",{parentName:"li"},"Generella inst\xe4llningar")),Object(i.b)("li",{parentName:"ul"},"mrcStatus - ",Object(i.b)("em",{parentName:"li"},"Hantering & inst\xe4llningar av status-lysdioder")),Object(i.b)("li",{parentName:"ul"},"mrcWifi - ",Object(i.b)("em",{parentName:"li"},"Hantering & inst\xe4llningar av n\xe4tverket"))),Object(i.b)("h2",{id:"grundinst\xe4llningar"},"Grundinst\xe4llningar"),Object(i.b)("p",null,"N\xe5gra generella inst\xe4llningar och n\xe5gra som kan vara specifika f\xf6r varje anv\xe4ndning av programmet, har samlats i en separat fil som heter ",Object(i.b)("em",{parentName:"p"},"mrcSettings.h"),". Denna fil inkluderas i huvudprogrammet vid kompilering."),Object(i.b)("p",null,"Du \xe4ndra dessa inst\xe4llningar enkelt i en texteditor eller i Arduion IDE och sparar dem lokalt."),Object(i.b)("h3",{id:"in--och-utg\xe5ngar"},"In- och utg\xe5ngar"),Object(i.b)("p",null,"H\xe4r kan man exempelvis vilja \xe4ndra vilka in-/utg\xe5ngar som anv\xe4nds av enheten:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"// Pin\nint pinVx1Led1 = D4;    // Which pin the first status led is attached to\nint pinVx1Led2 = D3;    // Which pin the second status led is attached to\nint pinVx1Button = D2;  // Which pin the first button is attached to\nint pinVx1Servo = D1;   // Which pin the first servo is attached to\nint pinVx2Servo = RX;   // Which pin the second servo is attached to\n")),Object(i.b)("p",null,"F\xf6ljande in-/utg\xe5ngar anv\xe4nds som standard p\xe5 en Wemos kretskortsdator:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Anv\xe4ndning"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"Vx1 pin"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"Vx2 pin"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"Kretkort"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Lysdiod 1"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"D4"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"D0"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"L1")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Lysdiod 2"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"D3"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"D5"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"L2")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Knapp"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"D2"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"D6"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"Btn")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Servo 1"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"D1"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"D7"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"S1")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Servo 2"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"Rx"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"Tx"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"S2")))),Object(i.b)("h3",{id:"namn-och-l\xf6senord"},"Namn och l\xf6senord"),Object(i.b)("p",null,"Om man vill ha ett annat startl\xf6senord och -namn f\xf6r hur man komm\xe5t \xe5t enhetens inst\xe4llningar, f\xe5r man \xe4ndra det p\xe5 f\xf6ljande tv\xe5 rader. Kan rekommenderas om man \xe4r noga med s\xe4kerheten."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),'// Access point configuration\nconst char thingName[] = "MRC-client";                 // Initial AP name, used as SSID of the own Access Point\nconst char wifiInitialApPassword[] = "mrc4president";  // Initial password, used when it creates an own Access Point\n')),Object(i.b)("h3",{id:"fels\xf6kning"},"Fels\xf6kning"),Object(i.b)("p",null,"Man kan \xe4ven vilja \xe4ndra inst\xe4llningarna f\xf6r vilken fels\xf6knings-information som visas p\xe5 seriella monitorn."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),'// Debug\nbyte debug = 1;     // Set to "1" for debug messages in Serial monitor (9600 baud)\n')),Object(i.b)("h2",{id:"huvudprogrammet"},"Huvudprogrammet"),Object(i.b)("h3",{id:"program-initiering"},"Program-initiering"),Object(i.b)("p",null,"H\xe4r g\xf6rs alla olika initieringar och inst\xe4llningar som beh\xf6vs f\xf6r att programmet ska ha r\xe4tt f\xf6rus\xe4ttningar. En del av inst\xe4llningarna sker \xe4ven genom att anropa andra funktioner."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"void setup() {\n    // Application setup\n}\n")),Object(i.b)("h3",{id:"huvudprogrammet-1"},"Huvudprogrammet"),Object(i.b)("p",null,'I programmets huvuddel hanteras alla \xe5terkommande "arbeten", s\xe5 som att h\xe5lla status-lysdioder blinkande, servon r\xf6rliga och anslutningen till MQTT-servern ig\xe5ng.'),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"void loop() {\n    // Main loop\n}\n")),Object(i.b)("p",null,"H\xe4r finns \xe4ven en kontroll av om programmet startat f\xf6r f\xf6rsta g\xe5ngen, f\xf6r d\xe5 ska n\xe4mligen lysdioderna visa det genom att blinka p\xe5 ett annorlunda s\xe4tt."),Object(i.b)("h3",{id:"knapp-hantering"},"Knapp-hantering"),Object(i.b)("p",null,"Knapparna hanteras av ett bibliotek som heter ",Object(i.b)("em",{parentName:"p"},"EasyButton")," och underh\xe5lls av ",Object(i.b)("em",{parentName:"p"},"Evert Arias"),". Mer information om dess hantering hittas p\xe5 ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/evert-arias/EasyButton"}),"bibliotekets Github-sidor"),"."),Object(i.b)("p",null,"Det finns \xe4ven egna funktioner som hanterar knapptryckningarna. D\xe4r avg\xf6rs vilket l\xe4ge knappen satts i och utifr\xe5n det avg\xf6rs hur servo och lysdioder ska reagera."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"void btn1Pressed () {\n    // Function that gets called when a button is pressed\n}\n")),Object(i.b)("h3",{id:"servohantering"},"Servohantering"),Object(i.b)("p",null,'N\xe5gra av funktionerna hanterar vad som ska h\xe4nda n\xe4r ett servo n\xe5tt sitt \xe4ndl\xe4ge. D\xe4r kontrolleras om ett eventuellt "parservo" ocks\xe5 r\xf6rt sig klart och visar sen med lysdioderna hur v\xe4xeln blivit lagd.'),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"void servo1aFinished () {\n    // Function that gets called when a servo finished moving\n}\n")),Object(i.b)("h2",{id:"servo-funktioner"},"Servo-funktioner"),Object(i.b)("h3",{id:"skapa-ett-servo-objekt"},"Skapa ett servo-objekt"),Object(i.b)("p",null,"Skapar ett nytt objekt 'MyServo' f\xf6r att kunna styra ett servo p\xe5 vald utg\xe5ng, i detta fall pin D1."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"mrcServo MyServo(D1);\n")),Object(i.b)("h3",{id:"st\xe4ll-in-servots-egenskaper"},"St\xe4ll in servots egenskaper"),Object(i.b)("p",null,'St\xe4ller in \xe4ndl\xe4gen och hastighet p\xe5 servo samt ger m\xf6jlighet att "lossa" servot fr\xe5n ett sp\xe4nt l\xe4ge.'),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"void setup() { \n    MyServo.limits(min, max, hastighet, justering);\n}\n")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"min")," \xe4r en siffra mellan 0 och 180 som st\xe4ller in servots ena \xe4ndl\xe4ge"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"max")," \xe4r en siffra mellan 0 och 180 som st\xe4ller in servots andra \xe4ndl\xe4ge"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"hastighet")," \xe4r antalet millisekunder som servot v\xe4ntar mellan varje steg det stegar fram"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"justering")," \xe4r antalet extra steg servot tar utanf\xf6r \xe4ndl\xe4get, f\xf6r att sen stega tillbaka lika m\xe5nga steg igen. Se illustration nedan:")),Object(i.b)("p",null,Object(i.b)("img",{alt:"Hur &#39;justering&#39; fungerar",src:n(198).default})),Object(i.b)("h3",{id:"servo-hantering"},"Servo-hantering"),Object(i.b)("p",null,'F\xf6r att servofunktionerna ska fungera beh\xf6ver det "st\xe4ndigt" kontrolleras om det finns n\xe5gon servo-aktivitet p\xe5 g\xe5ng, att starta eller att avsluta.\nDetta g\xf6r du genom att i programmets huvuddel anropa funktionen ',Object(i.b)("inlineCode",{parentName:"p"},"loop()"),"."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"void loop() {\n    MyServo.loop();\n}\n")),Object(i.b)("h3",{id:"flytta-servot"},"Flytta servot"),Object(i.b)("p",null,"Det finns tre olika kommandon f\xf6r att \xe4ndra servots l\xe4ge:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"    MyServo.closed();\n    MyServo.thrown();\n    MyServo.moveTo (180);\n")),Object(i.b)("p",null,"Du anv\xe4nder dem p\xe5 f\xf6ljande s\xe4tt:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"closed()")," g\xf6r att servot stegar till MAX \xe4ndpunkt"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"thrown()")," g\xf6r att servot stegar till MIN \xe4ndpunkt"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"moveTo()")," flyttar servot till en angiven punkt/vinkel, mellan 0 och 180")),Object(i.b)("h3",{id:"detektera-servots-\xe4ndpunkter"},"Detektera servots \xe4ndpunkter"),Object(i.b)("p",null,"Anger en funktion som ska anropas n\xe4r servot har r\xf6rt sig klart, d.v.s n\xe5tt det \xe4ndl\xe4ge som senaste kommandot angett. "),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"void setup() { \n    MyServo.onFinished(myServoCallback);\n}\n")),Object(i.b)("p",null,"Du kan sen skapa en funtion som heter ",Object(i.b)("inlineCode",{parentName:"p"},"MyServoCallback"),"och d\xe4r utf\xf6ra valfria \xe5tg\xe4rder n\xe4r servot n\xe5tt \xe4ndpunkten"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),'void myServoCallback () {\n    Serial.println("Servo har n\xe5tt \xe4ndl\xe4get");\n}\n')),Object(i.b)("h3",{id:"h\xe4mta-servostatus"},"H\xe4mta servostatus"),Object(i.b)("p",null,"Denna funktion kan du anropa f\xf6r att kontrollera vilken aktivitet servot har p\xe5 g\xe5ng."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"    status = MyServo.status();\n")),Object(i.b)("p",null,"Du kan f\xe5 tre olika svar:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"NON = 0,")," betyder att servot inte g\xf6r n\xe5got"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"MIN = 1,")," servot \xe4r p\xe5 v\xe4g till MIN-l\xe4get"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"MAX = 2")," servot \xe4r p\xe5 v\xe4g till MAX-l\xe4get")),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"Observera")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"Denna funktion fungerar inte korrekt i dagsl\xe4get (2020-12-21), utan ger enbart ",Object(i.b)("inlineCode",{parentName:"p"},"false")," f\xf6r NON eller ",Object(i.b)("inlineCode",{parentName:"p"},"true")," f\xf6r MIN ",Object(i.b)("em",{parentName:"p"},"och")," MAX."))),Object(i.b)("h3",{id:"h\xe4mta-servoposition"},"H\xe4mta servoposition"),Object(i.b)("p",null,"Med denna funktion kan du ta reda p\xe5 i vilket \xe4ndl\xe4ge servot befinner sig i."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"    boolean position = MyServo.position();\n")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"0")," eller ",Object(i.b)("strong",{parentName:"li"},"false")," betyder att servot \xe4r i MIN-position"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"1")," eller ",Object(i.b)("strong",{parentName:"li"},"true")," betyder att servot \xe4r i MAX-position")),Object(i.b)("h2",{id:"status-funktioner"},"Status-funktioner"),Object(i.b)("h3",{id:"skapa-ett-status-objekt"},"Skapa ett status-objekt"),Object(i.b)("p",null,"Skapar ett nytt objekt 'MyStatus' f\xf6r att styra en lysdiod p\xe5 vald utg\xe5ng, i detta fall pin D4."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"mrcStatus MyStatus(D4);\n")),Object(i.b)("h3",{id:"status-hantering"},"Status-hantering"),Object(i.b)("p",null,'F\xf6r att statusfunktionerna ska fungera beh\xf6ver det "st\xe4ndigt" kontrolleras om det finns n\xe5gon servo-aktivitet p\xe5 g\xe5ng, att starta eller att avsluta.\nDetta g\xf6r du genom att i programmets huvuddel anropa funktionen ',Object(i.b)("inlineCode",{parentName:"p"},"loop()"),"."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"    MyStatus.loop();\n")),Object(i.b)("h3",{id:"statushantering"},"Statushantering"),Object(i.b)("p",null,"Du kan hantera lysdioden p\xe5 tre olika s\xe4tt, med f\xf6ljande kommandon:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"    MyStatus.on();\n    MyStatus.off();\n    MyStatus.blink(500);\n")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"on()")," t\xe4nder lysdioden"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"off()")," sl\xe4cker lysdioden"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"blink(500)")," g\xf6r att lysdioden blinkar med 500 millisekunders intervall")),Object(i.b)("h3",{id:"h\xe4mta-status"},"H\xe4mta status"),Object(i.b)("p",null,"Du anropas denna funktion f\xf6r att f\xe5 reda p\xe5 i vilket l\xe4ge lysdioden befinner sig i."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"    boolean MyStatus.status();\n")),Object(i.b)("p",null,"Du kan f\xe5 tre olika svar:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"OFF = 0,")," betyder att lysdioden \xe4r sl\xe4ckt"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"ON = 1,")," lysdioden \xe4r t\xe4nd"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"BLINK = 2")," lysdioden blinkar")),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"Observera")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"Denna funktion fungerar inte korrekt i dagsl\xe4get (2020-12-21), utan ger enbart ",Object(i.b)("inlineCode",{parentName:"p"},"false")," f\xf6r OFF eller ",Object(i.b)("inlineCode",{parentName:"p"},"true")," f\xf6r ON ",Object(i.b)("em",{parentName:"p"},"och")," BLINK."))),Object(i.b)("h2",{id:"mqtt-funktioner"},"MQTT-funktioner"),Object(i.b)("p",null,"Hanteringen av MQTT \xe4r uppdelad i tv\xe5 olika delar. En del d\xe4r ett separat biblioteks funktioner anv\xe4nds och en del d\xe4r programmets har egna MQTT-funktioner."),Object(i.b)("h3",{id:"pubsubclient"},"PubSubClient"),Object(i.b)("p",null,"F\xf6r hantering av MQTT-meddelanden anv\xe4nds ett separat bibliotek (library) som heter ",Object(i.b)("em",{parentName:"p"},"PubSubClient")," och underh\xe5lls av ",Object(i.b)("em",{parentName:"p"},"Nick O'Leary"),". Hur detta biblioteks funktioner kan anv\xe4ndas framg\xe5r av ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://pubsubclient.knolleary.net/"}),"PubSubClients webbplats"),"."),Object(i.b)("h3",{id:"inst\xe4llningar-f\xf6r-mqtt"},"Inst\xe4llningar f\xf6r MQTT"),Object(i.b)("p",null,"Alla inst\xe4llningar som beh\xf6vs f\xf6r MQTT har samlats i denna funktion."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"void setup() { \n  // Initial mqtt setup\n  mqttSetup();\n}\n")),Object(i.b)("p",null,"H\xe4r finns fr\xe4mst alla de \xe4mnen som programmet beh\xf6ver hantera samt en del f\xf6rutbest\xe4mnda meddelanden."),Object(i.b)("h3",{id:"anslut-till-mqtt-server"},"Anslut till MQTT-server"),Object(i.b)("p",null,"Funktionen f\xf6r att ansluta sig till MQTT-servern inneh\xe5ller f\xf6rutom sj\xe4lva anslutningsrutinerna, \xe4ven rutiner f\xf6r att publicera till och prenumerera p\xe5 olika \xe4mnen."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"mqttConnect();\n")),Object(i.b)("h3",{id:"publicera-meddelande"},"Publicera meddelande"),Object(i.b)("p",null,"N\xe4r man i programmet vill publicera ett meddelande till ett \xe4mne, anv\xe4nder man funktionen mqttPublish."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),'mqttPublish("mrc/enhet01/turnout/set", "closed", 1);\n')),Object(i.b)("p",null,"De tre olika parametrarna anv\xe4nds s\xe5 h\xe4r:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"mrc/enhet01/turnout/set")," \xe4r \xe4mnet man vill publicera till"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"closed"),", \xe4r meddelandet som ska publiceras"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"1")," anger att meddelandet ska ligga kvar \xe4ven efter publiceringen. Med en nolla (0) h\xe4r, kommer meddelandet att f\xf6rsvinna s\xe5 fort de som prenumererae p\xe5 \xe4mnet har f\xe5tt meddelandet")),Object(i.b)("h3",{id:"prenumerera-p\xe5-meddelanden"},"Prenumerera p\xe5 meddelanden"),Object(i.b)("p",null,"F\xf6r att kunna ta emot meddelanden fr\xe5n MQTT-servern, finns en funktion som hanterar detta. I denna funktion tas meddelandet emot hanteras beroende p\xe5 inneh\xe5ll."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"void mqttCallback(char* topic, byte* payload, unsigned int length) {\n    // Function to handle MQTT messages sent to this device\n}\n")),Object(i.b)("h2",{id:"wifi-funktioner"},"Wifi-funktioner"),Object(i.b)("p",null,"\xc4ven hanteringen av wifi/tr\xe5dl\xf6st n\xe4tverk \xe4r uppdelad i tv\xe5 olika delar. Det mesta hanteras av ett separat biblioteks funktioner och sj\xe4lva programmet har endast en egen wifi-funktion."),Object(i.b)("h3",{id:"iotwebconf"},"IotWebConf"),Object(i.b)("p",null,"Det mesta av hanteringen kring tr\xe5sl\xf6sa n\xe4tverket ",Object(i.b)("em",{parentName:"p"},"och")," programmets m\xf6jligheter till anv\xe4ndar-inst\xe4llningar hanteras av ett bibliotek som heter ",Object(i.b)("em",{parentName:"p"},"IotWebConf")," och underh\xe5lls av ",Object(i.b)("em",{parentName:"p"},"Balazs Kelemen"),". Mer information om dess hantering hittas p\xe5 ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/prampec/IotWebConf"}),"bibliotekets Github-sidor"),"."),Object(i.b)("h3",{id:"spara-inst\xe4llningar"},"Spara inst\xe4llningar"),Object(i.b)("p",null,"En funktion som hanterar sparandet av inst\xe4llningar ligger i programmets huvuddel:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"void configSaved() {\n    // Function that gets called when IotWebConf web page config has been saved\n}\n")),Object(i.b)("h3",{id:"inst\xe4llningar-f\xf6r-wifi"},"Inst\xe4llningar f\xf6r wifi"),Object(i.b)("p",null,"Injst\xe4llningarna f\xf6r wifi \xe4r ganska omfattande och inneh\xe5ller en hel del kod som beh\xf6vs f\xf6r att kunna hantera anv\xe4ndar-inst\xe4llningar via en inbyggd webbsida. Dessa inst\xe4llningar \xe4r samlade i en egen funktion."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"void setup() { \n  // Initial wifi setup\n  wifiSetup();\n}\n")))}c.isMDXComponent=!0}}]);